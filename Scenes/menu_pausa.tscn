[gd_scene load_steps=5 format=3 uid="uid://cul825lramx12"]

[ext_resource type="Texture2D" uid="uid://b5uplvspnplxt" path="res://Resources/Menu/layer_pausa.png" id="3_mumad"]
[ext_resource type="Texture2D" uid="uid://deb1r88ekumta" path="res://Resources/Menu/Banner.png" id="3_pq2yk"]
[ext_resource type="Texture2D" uid="uid://bqbtcxbjsx20v" path="res://Resources/Menu/layer_button_salir.png" id="5_iefth"]

[sub_resource type="GDScript" id="GDScript_pq2yk"]
script/source = "extends Control

# --- REFERENCIAS ---
# CORRECCIÓN AQUÍ: El botón ahora es un hijo directo de MenuPausa, no de VBoxContainer.
@onready var boton_salir = $BotonSalir 

# --- MEMORIA DEL RATÓN ---
var modo_raton_anterior = Input.MOUSE_MODE_CAPTURED

func _ready() -> void:
	# La imagen del menú de pausa (MenuPausa) ya debe tener visibilidad desactivada en el editor.
	visible = false
	
	# La conexión sigue siendo válida
	if boton_salir:
		boton_salir.pressed.connect(_on_boton_salir_pressed)
	else:
		# Añadido un mensaje de error útil si olvidaste renombrar el botón
		print(\"ERROR: No se encontró el BotonSalir. Revisa el nombre del nodo.\")

func _input(event: InputEvent) -> void:
	if event.is_action_pressed(\"ui_cancel\"):
		cambiar_pausa()

func cambiar_pausa():
	# 1. Invertir estado de pausa
	var nuevo_estado = !get_tree().paused
	get_tree().paused = nuevo_estado
	
	# 2. Mostrar/Ocultar menú visual
	visible = nuevo_estado
	
	# 3. MANEJO INTELIGENTE DEL RATÓN (Esta lógica no cambia, es correcta)
	if nuevo_estado:
		# --- ESTAMOS PAUSANDO ---
		modo_raton_anterior = Input.get_mouse_mode()
		Input.mouse_mode = Input.MOUSE_MODE_VISIBLE
		
	else:
		# --- ESTAMOS QUITANDO LA PAUSA ---
		# Restauramos el ratón al modo que tenía antes de pausar (VISIBLE para Quiz, CAPTURED para jugar)
		Input.mouse_mode = modo_raton_anterior

func _on_boton_salir_pressed() -> void:
	get_tree().quit()
"

[node name="MenuPausa" type="Control"]
process_mode = 3
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = SubResource("GDScript_pq2yk")

[node name="ColorRect" type="ColorRect" parent="."]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.7176471)

[node name="Banner" type="Sprite2D" parent="."]
position = Vector2(576, 73.00001)
scale = Vector2(0.327044, 0.32704404)
texture = ExtResource("3_pq2yk")

[node name="LayerPausa" type="Sprite2D" parent="."]
position = Vector2(569.00006, 273)
scale = Vector2(0.2830189, 0.28301886)
texture = ExtResource("3_mumad")

[node name="BotonSalir" type="TextureButton" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.324
anchor_top = 0.606
anchor_right = 0.67600006
anchor_bottom = 0.77300006
offset_left = -0.24798584
offset_top = 0.3119812
offset_right = 0.2479248
offset_bottom = 0.095947266
texture_normal = ExtResource("5_iefth")
ignore_texture_size = true
stretch_mode = 0
